<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LogCabin: LogCabin::Server::RaftConsensusInternal::ClusterClock Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">LogCabin
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceLogCabin.html">LogCabin</a>      </li>
      <li class="navelem"><a class="el" href="namespaceLogCabin_1_1Server.html">Server</a>      </li>
      <li class="navelem"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html">RaftConsensusInternal</a>      </li>
      <li class="navelem"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html">ClusterClock</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">LogCabin::Server::RaftConsensusInternal::ClusterClock Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="LogCabin::Server::RaftConsensusInternal::ClusterClock" -->
<p>This is the rough equivalent of a SteadyClock that can be shared across the network with other Raft servers.  
 <a href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>&gt;</code></p>

<p><a href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a43efecbebdea1a5707fbc3d0ee20c757">ClusterClock</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Default constructor.  <a href="#a43efecbebdea1a5707fbc3d0ee20c757"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#ad5adb9f0618aeb7a7a55e1524849a8bc">newEpoch</a> (uint64_t clusterTime)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset to the given cluster time, assuming it's the current time right now.  <a href="#ad5adb9f0618aeb7a7a55e1524849a8bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#acfeeb3627de0308d4259324b78b7d84a">leaderStamp</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by leaders to generate a new cluster time for a new log entry.  <a href="#acfeeb3627de0308d4259324b78b7d84a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a348adcaf81872e5046c141a95c7771fe">interpolate</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the best approximation of the current cluster time, assuming there's been a leader all along.  <a href="#a348adcaf81872e5046c141a95c7771fe"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a9d1de557c99f1ad6b3b175f9d4838983">clusterTimeAtEpoch</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Invariant: this is equal to the cluster time in:  <a href="#a9d1de557c99f1ad6b3b175f9d4838983"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLogCabin_1_1Core_1_1Time_1_1MockableClock.html#a25005848397dad2ae0d03826a755d7c8">Core::Time::SteadyClock::time_point</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#ad39b718a9463f3d114da58deb290065f">localTimeAtEpoch</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The local SteadyClock time when clusterTimeAtEpoch was set.  <a href="#ad39b718a9463f3d114da58deb290065f"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This is the rough equivalent of a SteadyClock that can be shared across the network with other Raft servers. </p>
<p>The cluster time approximately tracks how long the cluster has been available with a working leader.</p>
<p>Cluster time is measured in nanoseconds and progresses at about the same rate as a normal clock when the cluster is operational. While there's a stable leader, the nanoseconds increase according to that leader's SteadyClock. When a new leader takes over, it starts ticking from cluster time value it finds in its last entry/snapshot, so some cluster time may be unaccounted for between the last leader replicating its final entry and then losing leadership.</p>
<p>The <a class="el" href="classLogCabin_1_1Server_1_1StateMachine.html" title="Interprets and executes operations that have been committed into the Raft log.">StateMachine</a> uses cluster time to expire client sessions. Cluster times in committed log entries monotonically increase, so the state machine will see cluster times monotonically increase.</p>
<p>Before cluster time, client sessions were expired based on the SystemClock. That meant that if the SystemClock jumped forwards drastically, all clients would expire. That's undesirable, so cluster time was introduced in #90 ("make client session timeout use monotonic clock") to address this. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00831">831</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a43efecbebdea1a5707fbc3d0ee20c757"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::ClusterClock" ref="a43efecbebdea1a5707fbc3d0ee20c757" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a43efecbebdea1a5707fbc3d0ee20c757">LogCabin::Server::RaftConsensusInternal::ClusterClock::ClusterClock</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default constructor. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00821">821</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ad5adb9f0618aeb7a7a55e1524849a8bc"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::newEpoch" ref="ad5adb9f0618aeb7a7a55e1524849a8bc" args="(uint64_t clusterTime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#ad5adb9f0618aeb7a7a55e1524849a8bc">LogCabin::Server::RaftConsensusInternal::ClusterClock::newEpoch</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>clusterTime</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reset to the given cluster time, assuming it's the current time right now. </p>
<p>This is used, for example, when a follower gets a new log entry (which includes a cluster time) from the leader. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00828">828</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="acfeeb3627de0308d4259324b78b7d84a"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::leaderStamp" ref="acfeeb3627de0308d4259324b78b7d84a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#acfeeb3627de0308d4259324b78b7d84a">LogCabin::Server::RaftConsensusInternal::ClusterClock::leaderStamp</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called by leaders to generate a new cluster time for a new log entry. </p>
<p>This is equivalent to the following but slightly more efficient: uint64_t now = c.interpolate(); c.newEpoch(now); return now; </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00835">835</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a348adcaf81872e5046c141a95c7771fe"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::interpolate" ref="a348adcaf81872e5046c141a95c7771fe" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a348adcaf81872e5046c141a95c7771fe">LogCabin::Server::RaftConsensusInternal::ClusterClock::interpolate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the best approximation of the current cluster time, assuming there's been a leader all along. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00847">847</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a9d1de557c99f1ad6b3b175f9d4838983"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::clusterTimeAtEpoch" ref="a9d1de557c99f1ad6b3b175f9d4838983" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#a9d1de557c99f1ad6b3b175f9d4838983">LogCabin::Server::RaftConsensusInternal::ClusterClock::clusterTimeAtEpoch</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Invariant: this is equal to the cluster time in: </p>
<ul>
<li>the last log entry, if any, or</li>
<li>the last snapshot, if any, or</li>
<li>0. </li>
</ul>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00864">864</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad39b718a9463f3d114da58deb290065f"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::ClusterClock::localTimeAtEpoch" ref="ad39b718a9463f3d114da58deb290065f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLogCabin_1_1Core_1_1Time_1_1MockableClock.html#a25005848397dad2ae0d03826a755d7c8">Core::Time::SteadyClock::time_point</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ClusterClock.html#ad39b718a9463f3d114da58deb290065f">LogCabin::Server::RaftConsensusInternal::ClusterClock::localTimeAtEpoch</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The local SteadyClock time when clusterTimeAtEpoch was set. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00869">869</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Server/<a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a></li>
<li>Server/<a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
