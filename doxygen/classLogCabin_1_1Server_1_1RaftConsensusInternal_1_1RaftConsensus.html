<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LogCabin: LogCabin::Server::RaftConsensusInternal::RaftConsensus Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">LogCabin
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceLogCabin.html">LogCabin</a>      </li>
      <li class="navelem"><a class="el" href="namespaceLogCabin_1_1Server.html">Server</a>      </li>
      <li class="navelem"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html">RaftConsensusInternal</a>      </li>
      <li class="navelem"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html">RaftConsensus</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">LogCabin::Server::RaftConsensusInternal::RaftConsensus Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="LogCabin::Server::RaftConsensusInternal::RaftConsensus" --><!-- doxytag: inherits="LogCabin::Server::Consensus" -->
<p>An implementation of the Raft consensus algorithm.  
 <a href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for LogCabin::Server::RaftConsensusInternal::RaftConsensus:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.png" usemap="#LogCabin::Server::RaftConsensusInternal::RaftConsensus_map" alt=""/>
  <map id="LogCabin::Server::RaftConsensusInternal::RaftConsensus_map" name="LogCabin::Server::RaftConsensusInternal::RaftConsensus_map">
<area href="classLogCabin_1_1Server_1_1Consensus.html" title="This is the interface to the consensus module used by state machines." alt="LogCabin::Server::Consensus" shape="rect" coords="0,0,333,24"/>
</map>
 </div></div>

<p><a href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a> { <br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bfa902afc519a9b28591d496428e7e6b335">SUCCESS</a>, 
<br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bfabe09f273446e87ce894653f4b6d09076">FAIL</a>, 
<br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bfa875d4a4b6c7f7c5bb098f5c727e6fd56">RETRY</a>, 
<br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bfaf3647ba82dbe5d9bed749c423b49fc13">NOT_LEADER</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1eedbc606dacdb887012865b3816ec0e">RaftConsensus</a> (<a class="el" href="classLogCabin_1_1Server_1_1Globals.html">Globals</a> &amp;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a262bfee307ed43d8bd9230651307cfd8">globals</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a1eedbc606dacdb887012865b3816ec0e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#abcb72ad818a70ce7dd87760c7a8581c1">~RaftConsensus</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="#abcb72ad818a70ce7dd87760c7a8581c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae0d0bfcd7c69c9942b0272a289b7f27a">init</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize. Must be called before any other method.  <a href="#ae0d0bfcd7c69c9942b0272a289b7f27a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae89a876887b24d61f14956dddd1ce1aa">exit</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal the consensus module to exit (shut down threads, etc).  <a href="#ae89a876887b24d61f14956dddd1ce1aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4b0562bafbc421881ba2b946215f3d12">bootstrapConfiguration</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the log with a configuration consisting of just this server.  <a href="#a4b0562bafbc421881ba2b946215f3d12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac324616660bfe31e2c98d7d3f7ecaa3e">getConfiguration</a> (Protocol::Raft::SimpleConfiguration &amp;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aab8ccee6bc732959896dd2549222d6b6">configuration</a>, uint64_t &amp;id) const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current leader's active, committed, simple cluster configuration.  <a href="#ac324616660bfe31e2c98d7d3f7ecaa3e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a>, uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae60e130c53287756889a2ad3d5468640">getLastCommittedId</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the most recent entry ID that has been externalized by the replicated log.  <a href="#ae60e130c53287756889a2ad3d5468640"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4b0eab7d00fc5ebc790eb13dc3d59fbc">getLeaderHint</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the network address for a recent leader, if known, or empty string otherwise.  <a href="#a4b0eab7d00fc5ebc790eb13dc3d59fbc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLogCabin_1_1Server_1_1Consensus_1_1Entry.html">Consensus::Entry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa0fcb25a36af3e036f6f6e74aa089eb6">getNextEntry</a> (uint64_t lastEntryId) const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This returns the entry following lastEntryId in the replicated log.  <a href="#aa0fcb25a36af3e036f6f6e74aa089eb6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">SnapshotStats::SnapshotStats&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a87187e7ebbfbcdda1bd26cff9cba4982">getSnapshotStats</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return statistics that may be useful in deciding when to snapshot.  <a href="#a87187e7ebbfbcdda1bd26cff9cba4982"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a23731ebc7ecadb3d44da0d3d3b07659c">handleAppendEntries</a> (const Protocol::Raft::AppendEntries::Request &amp;request, Protocol::Raft::AppendEntries::Response &amp;response)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process an AppendEntries <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server.  <a href="#a23731ebc7ecadb3d44da0d3d3b07659c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8483d7ab1cd2da07d25176af1b27541">handleAppendSnapshotChunk</a> (const Protocol::Raft::AppendSnapshotChunk::Request &amp;request, Protocol::Raft::AppendSnapshotChunk::Response &amp;response)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process an AppendSnapshotChunk <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server.  <a href="#ac8483d7ab1cd2da07d25176af1b27541"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a96a33793d98dd3a877f2fd0e775455fd">handleRequestVote</a> (const Protocol::Raft::RequestVote::Request &amp;request, Protocol::Raft::RequestVote::Response &amp;response)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process a RequestVote <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server.  <a href="#a96a33793d98dd3a877f2fd0e775455fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a>, uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a044adafc0636e0d51639c86dc24cedb7">replicate</a> (const std::string &amp;operation)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Submit an operation to the replicated log.  <a href="#a044adafc0636e0d51639c86dc24cedb7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5977498d61a7f485fb820f009990966d">setConfiguration</a> (uint64_t id, const Protocol::Raft::SimpleConfiguration &amp;newConfiguration)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the cluster's configuration.  <a href="#a5977498d61a7f485fb820f009990966d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad972a7ee3e07e19205a56b435ca02515">beginSnapshot</a> (uint64_t lastIncludedIndex)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Start taking a snapshot.  <a href="#ad972a7ee3e07e19205a56b435ca02515"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a06654aa9da2607aa175e2b00a062c8cc">snapshotDone</a> (uint64_t lastIncludedIndex, std::unique_ptr&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a> &gt; writer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Complete taking a snapshot for the log entries in range [1, lastIncludedIndex].  <a href="#a06654aa9da2607aa175e2b00a062c8cc"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">State</a> { <br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711cad442de331e163d23069b86bdc7140981">FOLLOWER</a>, 
<br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711ca236119b76b206e816e8edb22932896fb">CANDIDATE</a>, 
<br/>
&#160;&#160;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711caae8bd1d4b99fd5595b22eba14aaaf8f2">LEADER</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">See <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a34d943bf836bb3f45633f9ec7b7c667a" title="The server&#39;s current role in the cluster (follower, candidate, or leader).">state</a>.  <a href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a">leaderDiskThreadMain</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush log entries to stable storage in the background on leaders.  <a href="#a1cb25a9efb212c25dae3b8bfee51fc9a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a2380be6db16674c80263e350925a6d41">timerThreadMain</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Start new elections when it's time to do so.  <a href="#a2380be6db16674c80263e350925a6d41"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1f0d77d25c59e83ce7c446726292aaa">peerThreadMain</a> (std::shared_ptr&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &gt; peer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiate RPCs to a specific server as necessary.  <a href="#ac1f0d77d25c59e83ce7c446726292aaa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8cee5d6c14ffda0da84ee3ecef03727">stepDownThreadMain</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return to follower state when, as leader, this server is not able to communicate with a quorum.  <a href="#ac8cee5d6c14ffda0da84ee3ecef03727"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae21de65d37a249f16dee91d3d2e9015a">advanceCommittedId</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Move forward <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db" title="The largest entry ID for which a quorum is known to have stored the same entry as this server has...">commitIndex</a> if possible.  <a href="#ae21de65d37a249f16dee91d3d2e9015a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a41cd3d9a97e2fa89b97dbcbf8625bb24">append</a> (const std::vector&lt; const <a class="el" href="classLogCabin_1_1Storage_1_1Log.html#a8ca64ace5d6ae6f0175186c595d4fbe0">Storage::Log::Entry</a> * &gt; &amp;entries)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Append entries to the log, set the configuration if this contains a configuration entry, and notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>.  <a href="#a41cd3d9a97e2fa89b97dbcbf8625bb24"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a9aae8186ade26fc6138f993ba0ee5ddd">appendEntries</a> (std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;lockGuard, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;peer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an AppendEntries <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server (either a heartbeat or containing an entry to replicate).  <a href="#a9aae8186ade26fc6138f993ba0ee5ddd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a3e919b7ff6d2d38d83c0223ecde47691">appendSnapshotChunk</a> (std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;lockGuard, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;peer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an AppendSnapshotChunk <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server (containing part of a snapshot file to replicate).  <a href="#a3e919b7ff6d2d38d83c0223ecde47691"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a99c3e4320ad96dc929a25c0fae70bd63">becomeLeader</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Transition to being a leader.  <a href="#a99c3e4320ad96dc929a25c0fae70bd63"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1a7962c0e417508be477e49e9506acb">discardUnneededEntries</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the prefix of the log that is redundant with this server's snapshot.  <a href="#ac1a7962c0e417508be477e49e9506acb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1b510ce271ec5a1fda2755b39b9039f">getLastLogTerm</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the term corresponding to log-&gt;getLastLogIndex().  <a href="#ac1b510ce271ec5a1fda2755b39b9039f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af4d97132c0851d8bd21ea515af0b3af1">interruptAll</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify the <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a> condition variable and cancel all current RPCs.  <a href="#af4d97132c0851d8bd21ea515af0b3af1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa6cab57eaa3a17298141e0a7d674701e">readSnapshot</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to read the latest good snapshot from disk.  <a href="#aa6cab57eaa3a17298141e0a7d674701e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a>, uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#adf156bd64caf25cbd6507153ab28a012">replicateEntry</a> (<a class="el" href="classLogCabin_1_1Storage_1_1Log.html#a8ca64ace5d6ae6f0175186c595d4fbe0">Storage::Log::Entry</a> &amp;entry, std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;lockGuard)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Append an entry to the log and wait for it to be committed.  <a href="#adf156bd64caf25cbd6507153ab28a012"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4775a07951d49b701e7102bdb9650c78">requestVote</a> (std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;lockGuard, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;peer)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a RequestVote <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server.  <a href="#a4775a07951d49b701e7102bdb9650c78"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#adbd38c5696ef668968a55a6474e892f0">setElectionTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the timer to start a new election and notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>.  <a href="#adbd38c5696ef668968a55a6474e892f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6">startNewElection</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Transitions to being a candidate from being a follower or candidate.  <a href="#ad20d4e86b9b92174f5f5f6ad1b6617e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af7d665fe39bb83a27a15d9fc1046c5e6">stepDown</a> (uint64_t newTerm)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Transition to being a follower.  <a href="#af7d665fe39bb83a27a15d9fc1046c5e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad537af7eb29ec2cdee4df514a1c88062">updateLogMetadata</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Persist critical state, such as the term and the vote, to stable storage.  <a href="#ad537af7eb29ec2cdee4df514a1c88062"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a93d3b1276a1ca640df1be05f205306c7">upToDateLeader</a> (std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;lockGuard) const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if every entry that might have already been marked committed on any leader is marked committed on this leader by the time this call returns.  <a href="#a93d3b1276a1ca640df1be05f205306c7"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Server_1_1Globals.html">Globals</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a262bfee307ed43d8bd9230651307cfd8">globals</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="namespaceLogCabin.html">LogCabin</a> daemon's top-level objects.  <a href="#a262bfee307ed43d8bd9230651307cfd8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Storage_1_1FilesystemUtil_1_1File.html">Storage::FilesystemUtil::File</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6b94e5fc1b8b662f3d6ac00143425ffe">storageDirectory</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Where the files for the log and snapshots are stored.  <a href="#a6b94e5fc1b8b662f3d6ac00143425ffe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe">mutex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This class behaves mostly like a monitor.  <a href="#ac19a9e103346ecdcfa7d06bf735880fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Core_1_1ConditionVariable.html">Core::ConditionVariable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca">stateChanged</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Notified when basically anything changes.  <a href="#a6f93f73520a919d45b19e96968db9cca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac598c836150cf09441c10c1f9e25fee4">exiting</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set to true when this class is about to be destroyed.  <a href="#ac598c836150cf09441c10c1f9e25fee4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0a31733af9e7b043cd1c703e44d1d076">numPeerThreads</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html#a45d9389965055a93871c27c0fa00817f" title="A thread that is used to send RPCs to the follower.">Peer::thread</a> threads that are still using this <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html" title="An implementation of the Raft consensus algorithm.">RaftConsensus</a> object.  <a href="#a0a31733af9e7b043cd1c703e44d1d076"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classLogCabin_1_1Storage_1_1Log.html">Storage::Log</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aad49b9bc289bd6431319aef813f7cef6">log</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides all storage for this server.  <a href="#aad49b9bc289bd6431319aef813f7cef6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a46a843f36c520797f45c92b64c37857c">logSyncQueued</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag to indicate that <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a" title="Flush log entries to stable storage in the background on leaders.">leaderDiskThreadMain</a> should flush recent log writes to stable storage.  <a href="#a46a843f36c520797f45c92b64c37857c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5020e71d7ed3118772dec6c7587ba813">leaderDiskThreadWorking</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af7d665fe39bb83a27a15d9fc1046c5e6" title="Transition to being a follower.">stepDown()</a> to wait on <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75" title="The thread that executes leaderDiskThreadMain() to flush log entries to stable storage in the backgro...">leaderDiskThread</a> without releasing <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe" title="This class behaves mostly like a monitor.">mutex</a>.  <a href="#a5020e71d7ed3118772dec6c7587ba813"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Configuration.html">Configuration</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aab8ccee6bc732959896dd2549222d6b6">configuration</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the servers that are part of the cluster.  <a href="#aab8ccee6bc732959896dd2549222d6b6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ConfigurationManager.html">ConfigurationManager</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a21dc5a2ac45769b005c3eabd7db074f7">configurationManager</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that 'configuration' reflects the latest state of the log and snapshot.  <a href="#a21dc5a2ac45769b005c3eabd7db074f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac77ce12e038db59e7e3a5543ffcb4e7c">currentTerm</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The latest term this server has seen.  <a href="#ac77ce12e038db59e7e3a5543ffcb4e7c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a34d943bf836bb3f45633f9ec7b7c667a">state</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The server's current role in the cluster (follower, candidate, or leader).  <a href="#a34d943bf836bb3f45633f9ec7b7c667a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a68a556c556f81723b3eed67e6c3a7577">lastSnapshotIndex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The latest good snapshot covers entries 1 through 'lastSnapshotIndex' (inclusive).  <a href="#a68a556c556f81723b3eed67e6c3a7577"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#abd196740be4fee2d3067c6048420aa3d">lastSnapshotTerm</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The term of the last entry covered by the latest good snapshot, or 0 if we have no snapshot.  <a href="#abd196740be4fee2d3067c6048420aa3d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5afeca2ef4deadcb3e82acff01e81e69">lastSnapshotBytes</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The size of the latest good snapshot in bytes, or 0 if we have no snapshot.  <a href="#a5afeca2ef4deadcb3e82acff01e81e69"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Reader.html">Storage::SnapshotFile::Reader</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a82c372a34409b4dae6eaf7ad559c65f6">snapshotReader</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If not NULL, this is a <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Reader.html" title="Assists in reading snapshot files from the local filesystem.">Storage::SnapshotFile::Reader</a> that covers up through lastSnapshotIndex.  <a href="#a82c372a34409b4dae6eaf7ad559c65f6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ab3a1001dd35c85ee1e8f4e6c9564eae1">snapshotWriter</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This is used in handleAppendSnapshotChunk when receiving a snapshot from the current leader.  <a href="#ab3a1001dd35c85ee1e8f4e6c9564eae1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db">commitIndex</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The largest entry ID for which a quorum is known to have stored the same entry as this server has.  <a href="#ad714a3dca60ec6e0bf66f6107d05f7db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aaedf269f50f0727f072b8c399cb71f7e">leaderId</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The server ID of the leader for this term.  <a href="#aaedf269f50f0727f072b8c399cb71f7e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a38f6032a9b1887bed430e873495190df">votedFor</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The server ID that this server voted for during this term's election, if any.  <a href="#a38f6032a9b1887bed430e873495190df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af6468e2726cf9c29c7442c51148ab102">currentEpoch</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A logical clock used to confirm leadership and connectivity.  <a href="#af6468e2726cf9c29c7442c51148ab102"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#a9b2ddcfb6434331d10e3ed84c66e14e3">TimePoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6a6e253bff399e77713f62056613ba21">startElectionAt</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The earliest time at which <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ade96f5eaf2a06e4d5ef8bafb089b524b" title="The thread that executes timerThreadMain() to begin new elections after periods of inactivity...">timerThread</a> should begin a new election with <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6" title="Transitions to being a candidate from being a follower or candidate.">startNewElection()</a>.  <a href="#a6a6e253bff399e77713f62056613ba21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#a9b2ddcfb6434331d10e3ed84c66e14e3">TimePoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5ea8454fb7f5ad18a4752c37563db650">withholdVotesUntil</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The earliest time at which RequestVote messages should be processed.  <a href="#a5ea8454fb7f5ad18a4752c37563db650"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75">leaderDiskThread</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a" title="Flush log entries to stable storage in the background on leaders.">leaderDiskThreadMain()</a> to flush log entries to stable storage in the background on leaders.  <a href="#a5b1e92314c102fd9495c767d62c0be75"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ade96f5eaf2a06e4d5ef8bafb089b524b">timerThread</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a2380be6db16674c80263e350925a6d41" title="Start new elections when it&#39;s time to do so.">timerThreadMain()</a> to begin new elections after periods of inactivity.  <a href="#ade96f5eaf2a06e4d5ef8bafb089b524b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae9b0677ddf3e389d250cec7c1dc231f1">stepDownThread</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8cee5d6c14ffda0da84ee3ecef03727" title="Return to follower state when, as leader, this server is not able to communicate with a quorum...">stepDownThreadMain()</a> to return to the follower state if the leader becomes disconnected from a quorum of servers.  <a href="#ae9b0677ddf3e389d250cec7c1dc231f1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Invariants.html">Invariants</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aab7ec848b114993c356c22ba2574f7a6">invariants</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad72f4957c67523b22066e78353027123">ELECTION_TIMEOUT_MS</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A follower waits for about this much inactivity before becoming a candidate and starting a new election.  <a href="#ad72f4957c67523b22066e78353027123"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad82647ccf9b107e5f68549247dd17e4d">HEARTBEAT_PERIOD_MS</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A leader sends RPCs at least this often, even if there is no data to send.  <a href="#ad82647ccf9b107e5f68549247dd17e4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aebdeb95bd64ec627e7e6b6833f2bbe35">RPC_FAILURE_BACKOFF_MS</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A candidate or leader waits this long after an <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> fails before sending another one, so as to not overwhelm the network with retries.  <a href="#aebdeb95bd64ec627e7e6b6833f2bbe35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad708ed9c08b1e19230adee467408989e">SOFT_RPC_SIZE_LIMIT</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Prefer to keep <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> requests under this size.  <a href="#ad708ed9c08b1e19230adee467408989e"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a7f9edc83ce331ae65e4c5b0e3ab33310">LocalServer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a96271876ebf48141f9e8188cf9e41901">Peer</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#afe377268e20d0a8f20b104c2b0f51a2f">Invariants</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6a43c13d40f0c14a51bf213dc5ed49d1">operator&lt;&lt;</a> (std::ostream &amp;os, const <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html">RaftConsensus</a> &amp;raft)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print out the contents of this class for debugging purposes.  <a href="#a6a43c13d40f0c14a51bf213dc5ed49d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a8eca5de1cad997495d6de116f13fbf63">operator&lt;&lt;</a> (std::ostream &amp;os, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">ClientResult</a> clientResult)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print out a ClientResult for debugging purposes.  <a href="#a8eca5de1cad997495d6de116f13fbf63"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a2b99532723f58f305e2b372d66086de1">operator&lt;&lt;</a> (std::ostream &amp;os, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">State</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a34d943bf836bb3f45633f9ec7b7c667a">state</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print out a State for debugging purposes.  <a href="#a2b99532723f58f305e2b372d66086de1"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>An implementation of the Raft consensus algorithm. </p>
<p>The algorithm is described at <a href="https://ramcloud.stanford.edu/raft.pdf">https://ramcloud.stanford.edu/raft.pdf</a> . In brief, Raft divides time into terms and elects a leader at the beginning of each term. This election mechanism guarantees that the emerging leader has at least all committed log entries. Once a candidate has received votes from a quorum, it replicates its own log entries in order to the followers. The leader is the only machine that serves client requests. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00760">760</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a0615edf4bb111f046846a730452b34bf"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::ClientResult" ref="a0615edf4bb111f046846a730452b34bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">LogCabin::Server::RaftConsensusInternal::RaftConsensus::ClientResult</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a0615edf4bb111f046846a730452b34bfa902afc519a9b28591d496428e7e6b335"></a><!-- doxytag: member="SUCCESS" ref="a0615edf4bb111f046846a730452b34bfa902afc519a9b28591d496428e7e6b335" args="" -->SUCCESS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0615edf4bb111f046846a730452b34bfabe09f273446e87ce894653f4b6d09076"></a><!-- doxytag: member="FAIL" ref="a0615edf4bb111f046846a730452b34bfabe09f273446e87ce894653f4b6d09076" args="" -->FAIL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0615edf4bb111f046846a730452b34bfa875d4a4b6c7f7c5bb098f5c727e6fd56"></a><!-- doxytag: member="RETRY" ref="a0615edf4bb111f046846a730452b34bfa875d4a4b6c7f7c5bb098f5c727e6fd56" args="" -->RETRY</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0615edf4bb111f046846a730452b34bfaf3647ba82dbe5d9bed749c423b49fc13"></a><!-- doxytag: member="NOT_LEADER" ref="a0615edf4bb111f046846a730452b34bfaf3647ba82dbe5d9bed749c423b49fc13" args="" -->NOT_LEADER</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00762">762</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a14a6602e14d73dc067e2b9de50c1711c"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::State" ref="a14a6602e14d73dc067e2b9de50c1711c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">LogCabin::Server::RaftConsensusInternal::RaftConsensus::State</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a34d943bf836bb3f45633f9ec7b7c667a" title="The server&#39;s current role in the cluster (follower, candidate, or leader).">state</a>. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a14a6602e14d73dc067e2b9de50c1711cad442de331e163d23069b86bdc7140981"></a><!-- doxytag: member="FOLLOWER" ref="a14a6602e14d73dc067e2b9de50c1711cad442de331e163d23069b86bdc7140981" args="" -->FOLLOWER</em>&nbsp;</td><td>
<p>A follower does not initiate RPCs. </p>
<p>It becomes a candidate with <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6" title="Transitions to being a candidate from being a follower or candidate.">startNewElection()</a> when a timeout elapses without hearing from a candidate/leader. This is the initial state for servers when they start up. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a14a6602e14d73dc067e2b9de50c1711ca236119b76b206e816e8edb22932896fb"></a><!-- doxytag: member="CANDIDATE" ref="a14a6602e14d73dc067e2b9de50c1711ca236119b76b206e816e8edb22932896fb" args="" -->CANDIDATE</em>&nbsp;</td><td>
<p>A candidate sends RequestVote RPCs in an attempt to become a leader. </p>
<p>It steps down to be a follower if it discovers a current leader, and it becomes leader if it collects votes from a quorum. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a14a6602e14d73dc067e2b9de50c1711caae8bd1d4b99fd5595b22eba14aaaf8f2"></a><!-- doxytag: member="LEADER" ref="a14a6602e14d73dc067e2b9de50c1711caae8bd1d4b99fd5595b22eba14aaaf8f2" args="" -->LEADER</em>&nbsp;</td><td>
<p>A leader sends AppendEntries RPCs to replicate its log onto followers. </p>
<p>It also sends heartbeats periodically during periods of inactivity to delay its followers from becoming candidates. It steps down to be a follower if it discovers a server with a higher term, if it can't communicate with a quorum, or if it is not part of the latest committed configuration. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l00895">895</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a1eedbc606dacdb887012865b3816ec0e"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::RaftConsensus" ref="a1eedbc606dacdb887012865b3816ec0e" args="(Globals &amp;globals)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1eedbc606dacdb887012865b3816ec0e">LogCabin::Server::RaftConsensusInternal::RaftConsensus::RaftConsensus</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1Globals.html">Globals</a> &amp;&#160;</td>
          <td class="paramname"><em>globals</em></td><td>)</td>
          <td><code> [explicit]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">globals</td><td>Handle to <a class="el" href="namespaceLogCabin.html">LogCabin</a>'s top-level objects. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00741">741</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="abcb72ad818a70ce7dd87760c7a8581c1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::~RaftConsensus" ref="abcb72ad818a70ce7dd87760c7a8581c1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#abcb72ad818a70ce7dd87760c7a8581c1">LogCabin::Server::RaftConsensusInternal::RaftConsensus::~RaftConsensus</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destructor. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00773">773</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ae0d0bfcd7c69c9942b0272a289b7f27a"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::init" ref="ae0d0bfcd7c69c9942b0272a289b7f27a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae0d0bfcd7c69c9942b0272a289b7f27a">LogCabin::Server::RaftConsensusInternal::RaftConsensus::init</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize. Must be called before any other method. </p>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#a52b1fdb655af3ef6abb23a8be190fc52">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00794">794</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ae89a876887b24d61f14956dddd1ce1aa"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::exit" ref="ae89a876887b24d61f14956dddd1ce1aa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae89a876887b24d61f14956dddd1ce1aa">LogCabin::Server::RaftConsensusInternal::RaftConsensus::exit</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Signal the consensus module to exit (shut down threads, etc). </p>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#a64f6b752812e77dcc3ba74865804f97f">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00857">857</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a4b0562bafbc421881ba2b946215f3d12"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::bootstrapConfiguration" ref="a4b0562bafbc421881ba2b946215f3d12" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4b0562bafbc421881ba2b946215f3d12">LogCabin::Server::RaftConsensusInternal::RaftConsensus::bootstrapConfiguration</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the log with a configuration consisting of just this server. </p>
<p>This should be called just once the very first time the very first server in your cluster is started. PANICs if any log entries or snapshots already exist. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00867">867</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac324616660bfe31e2c98d7d3f7ecaa3e"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getConfiguration" ref="ac324616660bfe31e2c98d7d3f7ecaa3e" args="(Protocol::Raft::SimpleConfiguration &amp;configuration, uint64_t &amp;id) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac324616660bfe31e2c98d7d3f7ecaa3e">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getConfiguration</a> </td>
          <td>(</td>
          <td class="paramtype">Protocol::Raft::SimpleConfiguration &amp;&#160;</td>
          <td class="paramname"><em>configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t &amp;&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the current leader's active, committed, simple cluster configuration. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00894">894</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ae60e130c53287756889a2ad3d5468640"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLastCommittedId" ref="ae60e130c53287756889a2ad3d5468640" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a>, uint64_t &gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae60e130c53287756889a2ad3d5468640">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLastCommittedId</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the most recent entry ID that has been externalized by the replicated log. </p>
<p>This is used to provide non-stale reads to the state machine. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00911">911</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a4b0eab7d00fc5ebc790eb13dc3d59fbc"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLeaderHint" ref="a4b0eab7d00fc5ebc790eb13dc3d59fbc" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4b0eab7d00fc5ebc790eb13dc3d59fbc">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLeaderHint</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the network address for a recent leader, if known, or empty string otherwise. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00921">921</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="aa0fcb25a36af3e036f6f6e74aa089eb6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getNextEntry" ref="aa0fcb25a36af3e036f6f6e74aa089eb6" args="(uint64_t lastEntryId) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLogCabin_1_1Server_1_1Consensus_1_1Entry.html">Consensus::Entry</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa0fcb25a36af3e036f6f6e74aa089eb6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getNextEntry</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>lastEntryId</em></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This returns the entry following lastEntryId in the replicated log. </p>
<p>Some entries may be used internally by the consensus module. These will have Entry.hasData set to false. The reason these are exposed to the state machine is that the state machine waits to be caught up to the latest committed entry ID in the replicated log; sometimes, but that entry would otherwise never reach the state machine if it was for internal use. </p>
<dl class="exception"><dt><b>Exceptions:</b></dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classLogCabin_1_1Server_1_1ThreadInterruptedException.html">ThreadInterruptedException</a></td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#a2f3cc31a373453684bd88c6d7ba86ab8">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00928">928</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a87187e7ebbfbcdda1bd26cff9cba4982"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getSnapshotStats" ref="a87187e7ebbfbcdda1bd26cff9cba4982" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SnapshotStats::SnapshotStats <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a87187e7ebbfbcdda1bd26cff9cba4982">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getSnapshotStats</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return statistics that may be useful in deciding when to snapshot. </p>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#afa01aac8067e845fef1a92d1384a4f03">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00977">977</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a23731ebc7ecadb3d44da0d3d3b07659c"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleAppendEntries" ref="a23731ebc7ecadb3d44da0d3d3b07659c" args="(const Protocol::Raft::AppendEntries::Request &amp;request, Protocol::Raft::AppendEntries::Response &amp;response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a23731ebc7ecadb3d44da0d3d3b07659c">LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleAppendEntries</a> </td>
          <td>(</td>
          <td class="paramtype">const Protocol::Raft::AppendEntries::Request &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Protocol::Raft::AppendEntries::Response &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process an AppendEntries <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server. </p>
<p>Called by <a class="el" href="classLogCabin_1_1Server_1_1RaftService.html">RaftService</a>. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The request that was received from the other server. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">response</td><td>Where the reply should be placed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l00992">992</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac8483d7ab1cd2da07d25176af1b27541"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleAppendSnapshotChunk" ref="ac8483d7ab1cd2da07d25176af1b27541" args="(const Protocol::Raft::AppendSnapshotChunk::Request &amp;request, Protocol::Raft::AppendSnapshotChunk::Response &amp;response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8483d7ab1cd2da07d25176af1b27541">LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleAppendSnapshotChunk</a> </td>
          <td>(</td>
          <td class="paramtype">const Protocol::Raft::AppendSnapshotChunk::Request &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Protocol::Raft::AppendSnapshotChunk::Response &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process an AppendSnapshotChunk <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server. </p>
<p>Called by <a class="el" href="classLogCabin_1_1Server_1_1RaftService.html">RaftService</a>. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The request that was received from the other server. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">response</td><td>Where the reply should be placed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01117">1117</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a96a33793d98dd3a877f2fd0e775455fd"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleRequestVote" ref="a96a33793d98dd3a877f2fd0e775455fd" args="(const Protocol::Raft::RequestVote::Request &amp;request, Protocol::Raft::RequestVote::Response &amp;response)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a96a33793d98dd3a877f2fd0e775455fd">LogCabin::Server::RaftConsensusInternal::RaftConsensus::handleRequestVote</a> </td>
          <td>(</td>
          <td class="paramtype">const Protocol::Raft::RequestVote::Request &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Protocol::Raft::RequestVote::Response &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process a RequestVote <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> from another server. </p>
<p>Called by <a class="el" href="classLogCabin_1_1Server_1_1RaftService.html">RaftService</a>. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The request that was received from the other server. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">response</td><td>Where the reply should be placed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01197">1197</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a044adafc0636e0d51639c86dc24cedb7"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::replicate" ref="a044adafc0636e0d51639c86dc24cedb7" args="(const std::string &amp;operation)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a>, uint64_t &gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a044adafc0636e0d51639c86dc24cedb7">LogCabin::Server::RaftConsensusInternal::RaftConsensus::replicate</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Submit an operation to the replicated log. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">operation</td><td>If the cluster accepts this operation, then it will be added to the log and the state machine will eventually apply it. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01251">1251</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a5977498d61a7f485fb820f009990966d"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::setConfiguration" ref="a5977498d61a7f485fb820f009990966d" args="(uint64_t id, const Protocol::Raft::SimpleConfiguration &amp;newConfiguration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5977498d61a7f485fb820f009990966d">LogCabin::Server::RaftConsensusInternal::RaftConsensus::setConfiguration</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Protocol::Raft::SimpleConfiguration &amp;&#160;</td>
          <td class="paramname"><em>newConfiguration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change the cluster's configuration. </p>
<p>Returns once operation completed and old servers are no longer needed. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>Identifies a cluster configuration previously returned by <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac324616660bfe31e2c98d7d3f7ecaa3e" title="Get the current leader&#39;s active, committed, simple cluster configuration.">getConfiguration()</a>. </td></tr>
    <tr><td class="paramname">newConfiguration</td><td>Servers in new config, only use new_servers() part. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01262">1262</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ad972a7ee3e07e19205a56b435ca02515"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::beginSnapshot" ref="ad972a7ee3e07e19205a56b435ca02515" args="(uint64_t lastIncludedIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a> &gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad972a7ee3e07e19205a56b435ca02515">LogCabin::Server::RaftConsensusInternal::RaftConsensus::beginSnapshot</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>lastIncludedIndex</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start taking a snapshot. </p>
<p>Called by the state machine when it wants to take a snapshot. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">lastIncludedIndex</td><td>The snapshot will cover log entries in the range [1, lastIncludedIndex]. lastIncludedIndex must be committed (must have been previously returned by <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa0fcb25a36af3e036f6f6e74aa089eb6" title="This returns the entry following lastEntryId in the replicated log.">getNextEntry()</a>). </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A file the state machine can dump its snapshot into. </dd></dl>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#a791c4e3a12014586483b847be4d097bb">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01340">1340</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a06654aa9da2607aa175e2b00a062c8cc"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotDone" ref="a06654aa9da2607aa175e2b00a062c8cc" args="(uint64_t lastIncludedIndex, std::unique_ptr&lt; Storage::SnapshotFile::Writer &gt; writer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a06654aa9da2607aa175e2b00a062c8cc">LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotDone</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>lastIncludedIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a> &gt;&#160;</td>
          <td class="paramname"><em>writer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Complete taking a snapshot for the log entries in range [1, lastIncludedIndex]. </p>
<p>Called by the state machine when it is done taking a snapshot. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">lastIncludedIndex</td><td>The snapshot will cover log entries in the range [1, lastIncludedIndex]. </td></tr>
    <tr><td class="paramname">writer</td><td>A writer that has not yet been saved: the consensus module may have to discard the snapshot in case it's gotten a better snapshot from another server. If this snapshot is to be saved (normal case), the consensus module will call save() on it. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classLogCabin_1_1Server_1_1Consensus.html#aff3d1a1d849dab84cf83c2476ad50b80">LogCabin::Server::Consensus</a>.</p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01402">1402</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a1cb25a9efb212c25dae3b8bfee51fc9a"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThreadMain" ref="a1cb25a9efb212c25dae3b8bfee51fc9a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a">LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThreadMain</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flush log entries to stable storage in the background on leaders. </p>
<p>Once they're flushed, it tries to advance the <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db" title="The largest entry ID for which a quorum is known to have stored the same entry as this server has...">commitIndex</a>. This is the method that <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75" title="The thread that executes leaderDiskThreadMain() to flush log entries to stable storage in the backgro...">leaderDiskThread</a> executes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01485">1485</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a2380be6db16674c80263e350925a6d41"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::timerThreadMain" ref="a2380be6db16674c80263e350925a6d41" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a2380be6db16674c80263e350925a6d41">LogCabin::Server::RaftConsensusInternal::RaftConsensus::timerThreadMain</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start new elections when it's time to do so. </p>
<p>This is the method that <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ade96f5eaf2a06e4d5ef8bafb089b524b" title="The thread that executes timerThreadMain() to begin new elections after periods of inactivity...">timerThread</a> executes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01517">1517</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac1f0d77d25c59e83ce7c446726292aaa"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::peerThreadMain" ref="ac1f0d77d25c59e83ce7c446726292aaa" args="(std::shared_ptr&lt; Peer &gt; peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1f0d77d25c59e83ce7c446726292aaa">LogCabin::Server::RaftConsensusInternal::RaftConsensus::peerThreadMain</a> </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &gt;&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initiate RPCs to a specific server as necessary. </p>
<p>One thread for each remote server calls this method (see <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html#a45d9389965055a93871c27c0fa00817f" title="A thread that is used to send RPCs to the follower.">Peer::thread</a>). </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01529">1529</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac8cee5d6c14ffda0da84ee3ecef03727"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDownThreadMain" ref="ac8cee5d6c14ffda0da84ee3ecef03727" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8cee5d6c14ffda0da84ee3ecef03727">LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDownThreadMain</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return to follower state when, as leader, this server is not able to communicate with a quorum. </p>
<p>This helps two things in cases where a quorum is not available to this leader but clients can still communicate with the leader. First, it returns to clients in a timely manner so that they can try to find another current leader, if one exists. Second, it frees up the resources associated with those client's RPCs on the server. This is the method that <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae9b0677ddf3e389d250cec7c1dc231f1" title="The thread that executes stepDownThreadMain() to return to the follower state if the leader becomes d...">stepDownThread</a> executes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01581">1581</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ae21de65d37a249f16dee91d3d2e9015a"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::advanceCommittedId" ref="ae21de65d37a249f16dee91d3d2e9015a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae21de65d37a249f16dee91d3d2e9015a">LogCabin::Server::RaftConsensusInternal::RaftConsensus::advanceCommittedId</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move forward <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db" title="The largest entry ID for which a quorum is known to have stored the same entry as this server has...">commitIndex</a> if possible. </p>
<p>Called only on leaders after receiving <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> responses and flushing entries to disk. If commitIndex changes, this will notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>. It will also change the configuration or step down due to a configuration change when appropriate.</p>
<p><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db" title="The largest entry ID for which a quorum is known to have stored the same entry as this server has...">commitIndex</a> can jump by more than 1 on new leaders, since their <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db" title="The largest entry ID for which a quorum is known to have stored the same entry as this server has...">commitIndex</a> may be well out of date until they figure out which log entries their followers have.</p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>state is LEADER. TODO(ongaro): rename to advanceCommitIndex </dd></dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01631">1631</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a41cd3d9a97e2fa89b97dbcbf8625bb24"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::append" ref="a41cd3d9a97e2fa89b97dbcbf8625bb24" args="(const std::vector&lt; const Storage::Log::Entry * &gt; &amp;entries)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a41cd3d9a97e2fa89b97dbcbf8625bb24">LogCabin::Server::RaftConsensusInternal::RaftConsensus::append</a> </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; const <a class="el" href="classLogCabin_1_1Storage_1_1Log.html#a8ca64ace5d6ae6f0175186c595d4fbe0">Storage::Log::Entry</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>entries</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Append entries to the log, set the configuration if this contains a configuration entry, and notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01680">1680</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a9aae8186ade26fc6138f993ba0ee5ddd"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::appendEntries" ref="a9aae8186ade26fc6138f993ba0ee5ddd" args="(std::unique_lock&lt; Mutex &gt; &amp;lockGuard, Peer &amp;peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a9aae8186ade26fc6138f993ba0ee5ddd">LogCabin::Server::RaftConsensusInternal::RaftConsensus::appendEntries</a> </td>
          <td>(</td>
          <td class="paramtype">std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>lockGuard</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;&#160;</td>
          <td class="paramname"><em>peer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send an AppendEntries <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server (either a heartbeat or containing an entry to replicate). </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">lockGuard</td><td>Used to temporarily release the lock while invoking the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a>, so as to allow for some concurrency. </td></tr>
    <tr><td class="paramname">peer</td><td>State used in communicating with the follower, building the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> request, and processing its result. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01703">1703</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a3e919b7ff6d2d38d83c0223ecde47691"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::appendSnapshotChunk" ref="a3e919b7ff6d2d38d83c0223ecde47691" args="(std::unique_lock&lt; Mutex &gt; &amp;lockGuard, Peer &amp;peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a3e919b7ff6d2d38d83c0223ecde47691">LogCabin::Server::RaftConsensusInternal::RaftConsensus::appendSnapshotChunk</a> </td>
          <td>(</td>
          <td class="paramtype">std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>lockGuard</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;&#160;</td>
          <td class="paramname"><em>peer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send an AppendSnapshotChunk <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server (containing part of a snapshot file to replicate). </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">lockGuard</td><td>Used to temporarily release the lock while invoking the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a>, so as to allow for some concurrency. </td></tr>
    <tr><td class="paramname">peer</td><td>State used in communicating with the follower, building the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> request, and processing its result. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01833">1833</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a99c3e4320ad96dc929a25c0fae70bd63"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::becomeLeader" ref="a99c3e4320ad96dc929a25c0fae70bd63" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a99c3e4320ad96dc929a25c0fae70bd63">LogCabin::Server::RaftConsensusInternal::RaftConsensus::becomeLeader</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Transition to being a leader. </p>
<p>This is called when a candidate has received votes from a quorum. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01912">1912</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac1a7962c0e417508be477e49e9506acb"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::discardUnneededEntries" ref="ac1a7962c0e417508be477e49e9506acb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1a7962c0e417508be477e49e9506acb">LogCabin::Server::RaftConsensusInternal::RaftConsensus::discardUnneededEntries</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove the prefix of the log that is redundant with this server's snapshot. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01940">1940</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ac1b510ce271ec5a1fda2755b39b9039f"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLastLogTerm" ref="ac1b510ce271ec5a1fda2755b39b9039f" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac1b510ce271ec5a1fda2755b39b9039f">LogCabin::Server::RaftConsensusInternal::RaftConsensus::getLastLogTerm</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the term corresponding to log-&gt;getLastLogIndex(). </p>
<p>This may come from the log, from the snapshot, or it may be 0. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01952">1952</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="af4d97132c0851d8bd21ea515af0b3af1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::interruptAll" ref="af4d97132c0851d8bd21ea515af0b3af1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af4d97132c0851d8bd21ea515af0b3af1">LogCabin::Server::RaftConsensusInternal::RaftConsensus::interruptAll</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notify the <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a> condition variable and cancel all current RPCs. </p>
<p>This should be called when stepping down, starting a new election, becoming leader, or exiting. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01964">1964</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="aa6cab57eaa3a17298141e0a7d674701e"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::readSnapshot" ref="aa6cab57eaa3a17298141e0a7d674701e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa6cab57eaa3a17298141e0a7d674701e">LogCabin::Server::RaftConsensusInternal::RaftConsensus::readSnapshot</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Try to read the latest good snapshot from disk. </p>
<p>Loads the header of the snapshot file, which is used internally by the consensus module. The rest of the file reader is kept in <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a82c372a34409b4dae6eaf7ad559c65f6" title="If not NULL, this is a Storage::SnapshotFile::Reader that covers up through lastSnapshotIndex.">snapshotReader</a> for the state machine to process upon a future <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa0fcb25a36af3e036f6f6e74aa089eb6" title="This returns the entry following lastEntryId in the replicated log.">getNextEntry()</a>.</p>
<p>If the snapshot file on disk is no good, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a82c372a34409b4dae6eaf7ad559c65f6" title="If not NULL, this is a Storage::SnapshotFile::Reader that covers up through lastSnapshotIndex.">snapshotReader</a> will remain NULL. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01973">1973</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="adf156bd64caf25cbd6507153ab28a012"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::replicateEntry" ref="adf156bd64caf25cbd6507153ab28a012" args="(Storage::Log::Entry &amp;entry, std::unique_lock&lt; Mutex &gt; &amp;lockGuard)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a>, uint64_t &gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#adf156bd64caf25cbd6507153ab28a012">LogCabin::Server::RaftConsensusInternal::RaftConsensus::replicateEntry</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Storage_1_1Log.html#a8ca64ace5d6ae6f0175186c595d4fbe0">Storage::Log::Entry</a> &amp;&#160;</td>
          <td class="paramname"><em>entry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>lockGuard</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Append an entry to the log and wait for it to be committed. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02066">2066</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a4775a07951d49b701e7102bdb9650c78"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::requestVote" ref="a4775a07951d49b701e7102bdb9650c78" args="(std::unique_lock&lt; Mutex &gt; &amp;lockGuard, Peer &amp;peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a4775a07951d49b701e7102bdb9650c78">LogCabin::Server::RaftConsensusInternal::RaftConsensus::requestVote</a> </td>
          <td>(</td>
          <td class="paramtype">std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>lockGuard</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a> &amp;&#160;</td>
          <td class="paramname"><em>peer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a RequestVote <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> to the server. </p>
<p>This is used by candidates to request a server's vote and by new leaders to retrieve information about the server's log. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">lockGuard</td><td>Used to temporarily release the lock while invoking the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a>, so as to allow for some concurrency. </td></tr>
    <tr><td class="paramname">peer</td><td>State used in communicating with the follower, building the <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> request, and processing its result. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02085">2085</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="adbd38c5696ef668968a55a6474e892f0"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::setElectionTimer" ref="adbd38c5696ef668968a55a6474e892f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#adbd38c5696ef668968a55a6474e892f0">LogCabin::Server::RaftConsensusInternal::RaftConsensus::setElectionTimer</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the timer to start a new election and notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>. </p>
<p>The timer is set for ELECTION_TIMEOUT_MS plus some random jitter from now. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02133">2133</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ad20d4e86b9b92174f5f5f6ad1b6617e6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::startNewElection" ref="ad20d4e86b9b92174f5f5f6ad1b6617e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::startNewElection</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Transitions to being a candidate from being a follower or candidate. </p>
<p>This is called when a timeout elapses. If the configuration is blank, it does nothing. Moreover, if this server forms a quorum (it is the only server in the configuration), this will immediately transition to leader. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02143">2143</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="af7d665fe39bb83a27a15d9fc1046c5e6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDown" ref="af7d665fe39bb83a27a15d9fc1046c5e6" args="(uint64_t newTerm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af7d665fe39bb83a27a15d9fc1046c5e6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDown</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>newTerm</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Transition to being a follower. </p>
<p>This is called when we receive an <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> request with newer term, receive an <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> response indicating our term is stale, or discover a current leader while a candidate. In this last case, newTerm will be the same as currentTerm. This will call setElectionTimer for you if no election timer is currently set. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02174">2174</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ad537af7eb29ec2cdee4df514a1c88062"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::updateLogMetadata" ref="ad537af7eb29ec2cdee4df514a1c88062" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad537af7eb29ec2cdee4df514a1c88062">LogCabin::Server::RaftConsensusInternal::RaftConsensus::updateLogMetadata</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Persist critical state, such as the term and the vote, to stable storage. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02216">2216</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a93d3b1276a1ca640df1be05f205306c7"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::upToDateLeader" ref="a93d3b1276a1ca640df1be05f205306c7" args="(std::unique_lock&lt; Mutex &gt; &amp;lockGuard) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a93d3b1276a1ca640df1be05f205306c7">LogCabin::Server::RaftConsensusInternal::RaftConsensus::upToDateLeader</a> </td>
          <td>(</td>
          <td class="paramtype">std::unique_lock&lt; <a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>lockGuard</em></td><td>)</td>
          <td> const<code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return true if every entry that might have already been marked committed on any leader is marked committed on this leader by the time this call returns. </p>
<p>This is used to provide non-stale read operations to clients. It gives up after ELECTION_TIMEOUT_MS, since stepDownThread will return to the follower state after that time. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02226">2226</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a7f9edc83ce331ae65e4c5b0e3ab33310"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::LocalServer" ref="a7f9edc83ce331ae65e4c5b0e3ab33310" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1LocalServer.html">LocalServer</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01357">1357</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a96271876ebf48141f9e8188cf9e41901"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::Peer" ref="a96271876ebf48141f9e8188cf9e41901" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html">Peer</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01358">1358</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="afe377268e20d0a8f20b104c2b0f51a2f"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::Invariants" ref="afe377268e20d0a8f20b104c2b0f51a2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Invariants.html">Invariants</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01359">1359</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6a43c13d40f0c14a51bf213dc5ed49d1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::operator&lt;&lt;" ref="a6a43c13d40f0c14a51bf213dc5ed49d1" args="(std::ostream &amp;os, const RaftConsensus &amp;raft)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html">RaftConsensus</a> &amp;&#160;</td>
          <td class="paramname"><em>raft</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print out the contents of this class for debugging purposes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l01451">1451</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a8eca5de1cad997495d6de116f13fbf63"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::operator&lt;&lt;" ref="a8eca5de1cad997495d6de116f13fbf63" args="(std::ostream &amp;os, ClientResult clientResult)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0615edf4bb111f046846a730452b34bf">RaftConsensus::ClientResult</a>&#160;</td>
          <td class="paramname"><em>clientResult</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print out a ClientResult for debugging purposes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02258">2258</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a2b99532723f58f305e2b372d66086de1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::operator&lt;&lt;" ref="a2b99532723f58f305e2b372d66086de1" args="(std::ostream &amp;os, State state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">RaftConsensus::State</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print out a State for debugging purposes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8cc_source.html#l02279">2279</a> of file <a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="ad72f4957c67523b22066e78353027123"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::ELECTION_TIMEOUT_MS" ref="ad72f4957c67523b22066e78353027123" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad72f4957c67523b22066e78353027123">LogCabin::Server::RaftConsensusInternal::RaftConsensus::ELECTION_TIMEOUT_MS</a><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A follower waits for about this much inactivity before becoming a candidate and starting a new election. </p>
<p>Const except for unit tests. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01119">1119</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad82647ccf9b107e5f68549247dd17e4d"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::HEARTBEAT_PERIOD_MS" ref="ad82647ccf9b107e5f68549247dd17e4d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad82647ccf9b107e5f68549247dd17e4d">LogCabin::Server::RaftConsensusInternal::RaftConsensus::HEARTBEAT_PERIOD_MS</a><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A leader sends RPCs at least this often, even if there is no data to send. </p>
<p>Const except for unit tests. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01125">1125</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aebdeb95bd64ec627e7e6b6833f2bbe35"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::RPC_FAILURE_BACKOFF_MS" ref="aebdeb95bd64ec627e7e6b6833f2bbe35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aebdeb95bd64ec627e7e6b6833f2bbe35">LogCabin::Server::RaftConsensusInternal::RaftConsensus::RPC_FAILURE_BACKOFF_MS</a><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A candidate or leader waits this long after an <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> fails before sending another one, so as to not overwhelm the network with retries. </p>
<p>Const except for unit tests. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01132">1132</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad708ed9c08b1e19230adee467408989e"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::SOFT_RPC_SIZE_LIMIT" ref="ad708ed9c08b1e19230adee467408989e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad708ed9c08b1e19230adee467408989e">LogCabin::Server::RaftConsensusInternal::RaftConsensus::SOFT_RPC_SIZE_LIMIT</a><code> [static, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prefer to keep <a class="el" href="namespaceLogCabin_1_1RPC.html">RPC</a> requests under this size. </p>
<p>Const except for unit tests. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01138">1138</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a262bfee307ed43d8bd9230651307cfd8"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::globals" ref="a262bfee307ed43d8bd9230651307cfd8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1Globals.html">Globals</a>&amp; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a262bfee307ed43d8bd9230651307cfd8">LogCabin::Server::RaftConsensusInternal::RaftConsensus::globals</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The <a class="el" href="namespaceLogCabin.html">LogCabin</a> daemon's top-level objects. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01143">1143</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6b94e5fc1b8b662f3d6ac00143425ffe"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::storageDirectory" ref="a6b94e5fc1b8b662f3d6ac00143425ffe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Storage_1_1FilesystemUtil_1_1File.html">Storage::FilesystemUtil::File</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6b94e5fc1b8b662f3d6ac00143425ffe">LogCabin::Server::RaftConsensusInternal::RaftConsensus::storageDirectory</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Where the files for the log and snapshots are stored. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01148">1148</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac19a9e103346ecdcfa7d06bf735880fe"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::mutex" ref="ac19a9e103346ecdcfa7d06bf735880fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#aa167a7f1729c5e12a748dc4011a3039d">Mutex</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe">LogCabin::Server::RaftConsensusInternal::RaftConsensus::mutex</a><code> [mutable, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This class behaves mostly like a monitor. </p>
<p>This protects all the state in this class and almost all of the <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html" title="Represents another server in the cluster.">Peer</a> class (with some documented exceptions). </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01155">1155</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6f93f73520a919d45b19e96968db9cca"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::stateChanged" ref="a6f93f73520a919d45b19e96968db9cca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Core_1_1ConditionVariable.html">Core::ConditionVariable</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca">LogCabin::Server::RaftConsensusInternal::RaftConsensus::stateChanged</a><code> [mutable, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notified when basically anything changes. </p>
<p>Specifically, this is notified when any of the following events occur:</p>
<ul>
<li>term changes.</li>
<li>state changes.</li>
<li>log changes.</li>
<li>commitIndex changes.</li>
<li>exiting is set.</li>
<li>numPeerThreads is decremented.</li>
<li>configuration changes.</li>
<li>startElectionAt changes (see note under startElectionAt).</li>
<li>an acknowledgement from a peer is received.</li>
<li>a server goes from not caught up to caught up. TODO(ongaro): Should there be multiple condition variables? This one is used by a lot of threads for a lot of different conditions. </li>
</ul>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01173">1173</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac598c836150cf09441c10c1f9e25fee4"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::exiting" ref="ac598c836150cf09441c10c1f9e25fee4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac598c836150cf09441c10c1f9e25fee4">LogCabin::Server::RaftConsensusInternal::RaftConsensus::exiting</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set to true when this class is about to be destroyed. </p>
<p>When this is true, threads must exit right away and no more RPCs should be sent or processed. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01180">1180</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0a31733af9e7b043cd1c703e44d1d076"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::numPeerThreads" ref="a0a31733af9e7b043cd1c703e44d1d076" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a0a31733af9e7b043cd1c703e44d1d076">LogCabin::Server::RaftConsensusInternal::RaftConsensus::numPeerThreads</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The number of <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Peer.html#a45d9389965055a93871c27c0fa00817f" title="A thread that is used to send RPCs to the follower.">Peer::thread</a> threads that are still using this <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html" title="An implementation of the Raft consensus algorithm.">RaftConsensus</a> object. </p>
<p>When they exit, they decrement this and notify <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6f93f73520a919d45b19e96968db9cca" title="Notified when basically anything changes.">stateChanged</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01187">1187</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aad49b9bc289bd6431319aef813f7cef6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::log" ref="aad49b9bc289bd6431319aef813f7cef6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classLogCabin_1_1Storage_1_1Log.html">Storage::Log</a>&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aad49b9bc289bd6431319aef813f7cef6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::log</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Provides all storage for this server. </p>
<p>Keeps track of all log entries and some additional metadata.</p>
<p>If you modify this, be sure to keep <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a21dc5a2ac45769b005c3eabd7db074f7" title="Ensures that &#39;configuration&#39; reflects the latest state of the log and snapshot.">configurationManager</a> consistent. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01195">1195</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a46a843f36c520797f45c92b64c37857c"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::logSyncQueued" ref="a46a843f36c520797f45c92b64c37857c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a46a843f36c520797f45c92b64c37857c">LogCabin::Server::RaftConsensusInternal::RaftConsensus::logSyncQueued</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag to indicate that <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a" title="Flush log entries to stable storage in the background on leaders.">leaderDiskThreadMain</a> should flush recent log writes to stable storage. </p>
<p>This is always false for followers and candidates and is only used for leaders.</p>
<p>When a server steps down, it waits for all syncs to complete, that way followers can assume that all of their log entries are durable when replying to leaders. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01206">1206</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5020e71d7ed3118772dec6c7587ba813"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThreadWorking" ref="a5020e71d7ed3118772dec6c7587ba813" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5020e71d7ed3118772dec6c7587ba813">LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThreadWorking</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used for <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af7d665fe39bb83a27a15d9fc1046c5e6" title="Transition to being a follower.">stepDown()</a> to wait on <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75" title="The thread that executes leaderDiskThreadMain() to flush log entries to stable storage in the backgro...">leaderDiskThread</a> without releasing <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe" title="This class behaves mostly like a monitor.">mutex</a>. </p>
<p>This is true while <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75" title="The thread that executes leaderDiskThreadMain() to flush log entries to stable storage in the backgro...">leaderDiskThread</a> is writing to disk. It's set to true while holding <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe" title="This class behaves mostly like a monitor.">mutex</a>; set to false without <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac19a9e103346ecdcfa7d06bf735880fe" title="This class behaves mostly like a monitor.">mutex</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01213">1213</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aab8ccee6bc732959896dd2549222d6b6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::configuration" ref="aab8ccee6bc732959896dd2549222d6b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Configuration.html">Configuration</a>&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aab8ccee6bc732959896dd2549222d6b6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::configuration</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Defines the servers that are part of the cluster. </p>
<p>See <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Configuration.html" title="A configuration defines the servers that are part of the cluster.">Configuration</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01218">1218</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a21dc5a2ac45769b005c3eabd7db074f7"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::configurationManager" ref="a21dc5a2ac45769b005c3eabd7db074f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1ConfigurationManager.html">ConfigurationManager</a>&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a21dc5a2ac45769b005c3eabd7db074f7">LogCabin::Server::RaftConsensusInternal::RaftConsensus::configurationManager</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Ensures that 'configuration' reflects the latest state of the log and snapshot. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01224">1224</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac77ce12e038db59e7e3a5543ffcb4e7c"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::currentTerm" ref="ac77ce12e038db59e7e3a5543ffcb4e7c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac77ce12e038db59e7e3a5543ffcb4e7c">LogCabin::Server::RaftConsensusInternal::RaftConsensus::currentTerm</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The latest term this server has seen. </p>
<p>This value monotonically increases over time. It gets updated in <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af7d665fe39bb83a27a15d9fc1046c5e6" title="Transition to being a follower.">stepDown()</a>, <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6" title="Transitions to being a candidate from being a follower or candidate.">startNewElection()</a>, and when a candidate receives a vote response with a newer term. </p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>After setting this value, you must call <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad537af7eb29ec2cdee4df514a1c88062" title="Persist critical state, such as the term and the vote, to stable storage.">updateLogMetadata()</a> to persist it. </dd></dl>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01234">1234</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a34d943bf836bb3f45633f9ec7b7c667a"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::state" ref="a34d943bf836bb3f45633f9ec7b7c667a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c">State</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a34d943bf836bb3f45633f9ec7b7c667a">LogCabin::Server::RaftConsensusInternal::RaftConsensus::state</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The server's current role in the cluster (follower, candidate, or leader). </p>
<p>See <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a14a6602e14d73dc067e2b9de50c1711c" title="See state.">State</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01240">1240</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a68a556c556f81723b3eed67e6c3a7577"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotIndex" ref="a68a556c556f81723b3eed67e6c3a7577" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a68a556c556f81723b3eed67e6c3a7577">LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotIndex</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The latest good snapshot covers entries 1 through 'lastSnapshotIndex' (inclusive). </p>
<p>It is known that these are committed. They are safe to remove from the log, but it may be advantageous to keep them around for a little while (to avoid shipping snapshots to straggling followers). Thus, the log may or may not have some of the entries in this range. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01249">1249</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="abd196740be4fee2d3067c6048420aa3d"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotTerm" ref="abd196740be4fee2d3067c6048420aa3d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#abd196740be4fee2d3067c6048420aa3d">LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotTerm</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The term of the last entry covered by the latest good snapshot, or 0 if we have no snapshot. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01255">1255</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5afeca2ef4deadcb3e82acff01e81e69"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotBytes" ref="a5afeca2ef4deadcb3e82acff01e81e69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5afeca2ef4deadcb3e82acff01e81e69">LogCabin::Server::RaftConsensusInternal::RaftConsensus::lastSnapshotBytes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The size of the latest good snapshot in bytes, or 0 if we have no snapshot. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01261">1261</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a82c372a34409b4dae6eaf7ad559c65f6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotReader" ref="a82c372a34409b4dae6eaf7ad559c65f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Reader.html">Storage::SnapshotFile::Reader</a>&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a82c372a34409b4dae6eaf7ad559c65f6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotReader</a><code> [mutable, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If not NULL, this is a <a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Reader.html" title="Assists in reading snapshot files from the local filesystem.">Storage::SnapshotFile::Reader</a> that covers up through lastSnapshotIndex. </p>
<p>This is ready for the state machine to process and is returned to the state machine in <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa0fcb25a36af3e036f6f6e74aa089eb6" title="This returns the entry following lastEntryId in the replicated log.">getNextEntry()</a>. It's just a cache which can be repopulated with <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aa6cab57eaa3a17298141e0a7d674701e" title="Try to read the latest good snapshot from disk.">readSnapshot()</a>. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01269">1269</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab3a1001dd35c85ee1e8f4e6c9564eae1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotWriter" ref="ab3a1001dd35c85ee1e8f4e6c9564eae1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classLogCabin_1_1Storage_1_1SnapshotFile_1_1Writer.html">Storage::SnapshotFile::Writer</a>&gt; <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ab3a1001dd35c85ee1e8f4e6c9564eae1">LogCabin::Server::RaftConsensusInternal::RaftConsensus::snapshotWriter</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is used in handleAppendSnapshotChunk when receiving a snapshot from the current leader. </p>
<p>The leader is assumed to send at most one snapshot at a time, and any partial snapshots here are discarded when the term changes. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01277">1277</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad714a3dca60ec6e0bf66f6107d05f7db"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::commitIndex" ref="ad714a3dca60ec6e0bf66f6107d05f7db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad714a3dca60ec6e0bf66f6107d05f7db">LogCabin::Server::RaftConsensusInternal::RaftConsensus::commitIndex</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The largest entry ID for which a quorum is known to have stored the same entry as this server has. </p>
<p>Entries 1 through commitIndex as stored in this server's log are guaranteed to never change. This value will monotonically increase over time. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01285">1285</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaedf269f50f0727f072b8c399cb71f7e"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderId" ref="aaedf269f50f0727f072b8c399cb71f7e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aaedf269f50f0727f072b8c399cb71f7e">LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderId</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The server ID of the leader for this term. </p>
<p>This is used to help point clients to the right server. The special value 0 means either there is no leader for this term yet or this server does not know who it is yet. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01292">1292</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a38f6032a9b1887bed430e873495190df"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::votedFor" ref="a38f6032a9b1887bed430e873495190df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a38f6032a9b1887bed430e873495190df">LogCabin::Server::RaftConsensusInternal::RaftConsensus::votedFor</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The server ID that this server voted for during this term's election, if any. </p>
<p>The special value 0 means no vote has been given out during this term. </p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>After setting this value, you must call <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad537af7eb29ec2cdee4df514a1c88062" title="Persist critical state, such as the term and the vote, to stable storage.">updateLogMetadata()</a> to persist it. </dd></dl>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01302">1302</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="af6468e2726cf9c29c7442c51148ab102"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::currentEpoch" ref="af6468e2726cf9c29c7442c51148ab102" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#af6468e2726cf9c29c7442c51148ab102">LogCabin::Server::RaftConsensusInternal::RaftConsensus::currentEpoch</a><code> [mutable, private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A logical clock used to confirm leadership and connectivity. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01308">1308</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6a6e253bff399e77713f62056613ba21"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::startElectionAt" ref="a6a6e253bff399e77713f62056613ba21" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#a9b2ddcfb6434331d10e3ed84c66e14e3">TimePoint</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a6a6e253bff399e77713f62056613ba21">LogCabin::Server::RaftConsensusInternal::RaftConsensus::startElectionAt</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The earliest time at which <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ade96f5eaf2a06e4d5ef8bafb089b524b" title="The thread that executes timerThreadMain() to begin new elections after periods of inactivity...">timerThread</a> should begin a new election with <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ad20d4e86b9b92174f5f5f6ad1b6617e6" title="Transitions to being a candidate from being a follower or candidate.">startNewElection()</a>. </p>
<p>It is safe for increases to startElectionAt to not notify the condition variable. Decreases to this value, however, must notify the condition variable to make sure the timerThread gets woken in a timely manner. Unfortunately, startElectionAt does not monotonically increase because of the random jitter that is applied to the follower timeout, and it would reduce the jitter's effectiveness for the thread to wait as long as the largest startElectionAt value. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01322">1322</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5ea8454fb7f5ad18a4752c37563db650"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::withholdVotesUntil" ref="a5ea8454fb7f5ad18a4752c37563db650" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceLogCabin_1_1Server_1_1RaftConsensusInternal.html#a9b2ddcfb6434331d10e3ed84c66e14e3">TimePoint</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5ea8454fb7f5ad18a4752c37563db650">LogCabin::Server::RaftConsensusInternal::RaftConsensus::withholdVotesUntil</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The earliest time at which RequestVote messages should be processed. </p>
<p>Until this time, they are rejected, as processing them risks causing the cluster leader to needlessly step down. For more motivation, see the "disruptive servers" issue in membership changes described in the Raft paper/thesis.</p>
<p>This is set to the current time + an election timeout when a heartbeat is received, and it's set to infinity for leaders (who begin processing RequestVote messages again immediately when they step down). </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01335">1335</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5b1e92314c102fd9495c767d62c0be75"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThread" ref="a5b1e92314c102fd9495c767d62c0be75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a5b1e92314c102fd9495c767d62c0be75">LogCabin::Server::RaftConsensusInternal::RaftConsensus::leaderDiskThread</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a1cb25a9efb212c25dae3b8bfee51fc9a" title="Flush log entries to stable storage in the background on leaders.">leaderDiskThreadMain()</a> to flush log entries to stable storage in the background on leaders. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01341">1341</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ade96f5eaf2a06e4d5ef8bafb089b524b"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::timerThread" ref="ade96f5eaf2a06e4d5ef8bafb089b524b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ade96f5eaf2a06e4d5ef8bafb089b524b">LogCabin::Server::RaftConsensusInternal::RaftConsensus::timerThread</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#a2380be6db16674c80263e350925a6d41" title="Start new elections when it&#39;s time to do so.">timerThreadMain()</a> to begin new elections after periods of inactivity. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01347">1347</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae9b0677ddf3e389d250cec7c1dc231f1"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDownThread" ref="ae9b0677ddf3e389d250cec7c1dc231f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ae9b0677ddf3e389d250cec7c1dc231f1">LogCabin::Server::RaftConsensusInternal::RaftConsensus::stepDownThread</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The thread that executes <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#ac8cee5d6c14ffda0da84ee3ecef03727" title="Return to follower state when, as leader, this server is not able to communicate with a quorum...">stepDownThreadMain()</a> to return to the follower state if the leader becomes disconnected from a quorum of servers. </p>

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01353">1353</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aab7ec848b114993c356c22ba2574f7a6"></a><!-- doxytag: member="LogCabin::Server::RaftConsensusInternal::RaftConsensus::invariants" ref="aab7ec848b114993c356c22ba2574f7a6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1Invariants.html">Invariants</a> <a class="el" href="classLogCabin_1_1Server_1_1RaftConsensusInternal_1_1RaftConsensus.html#aab7ec848b114993c356c22ba2574f7a6">LogCabin::Server::RaftConsensusInternal::RaftConsensus::invariants</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="RaftConsensus_8h_source.html#l01355">1355</a> of file <a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>Server/<a class="el" href="RaftConsensus_8h_source.html">RaftConsensus.h</a></li>
<li>Server/<a class="el" href="RaftConsensus_8cc_source.html">RaftConsensus.cc</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
